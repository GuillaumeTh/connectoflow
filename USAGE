Connectoflow pipeline
===================

Run our state-of-the-art connectivity pipeline.
T1 and labels must be provided in their original space (output from freesurfer
or civet) and the affine and nonlinear transformation must bring these images
to diffusion space.

The rest of the input (tracking, dwi, peaks, fodf and all metrics)
must be in diffusion space with compatible headers.

It is mandatory that all grouped input either have identical prefix or no
prefix at all.

*labels.nii.gz and t1.nii.gz must have the same prefix in order to be read properly.

*dwi.nii.gz, *dwi.bval, *dwi.bvec, *fodf.nii.gz, *peaks.nii.gz must also have
the same prefix in order to be read properly.

The file *tracking*.[fib,trk,tck] must also follow this convention, but can
have any suffixes.

USAGE

nextflow run main.nf [OPTIONAL_ARGUMENTS] --root

DESCRIPTION

    --root=/path/to/[root]     Root folder containing multiple subjects
                                                [root]
                                                ├── S1
                                                │   │── *tracking*.[fib,trk,tck]
                                                │   │── *labels.nii.gz
                                                │   │── *t1.nii.gz
                                                │   │── *1Warp.nii.gz
                                                │   │── *0GenericAffine.mat
                                                │   │── *1Warp.nii.gz
                                                │   │── *dwi.nii.gz (optional)
                                                │   │── *dwi.bval (optional)
                                                │   │── *dwi.bvec (optional)
                                                │   │── *peaks.nii.gz (optional)
                                                │   │── *fodf.nii.gz (optional)
                                                |   └── metrics (optional)
                                                |       └── METRIC_NAME.nii.gz
                                                └── S2
                                                    └── *

    --template                                  Template used for registration in a common space for similarity/viz
    --labels_list                               Complete (expected) labels_list of the atlas used
    --labels_img_prefix                         Specify a prefix for the labels to use (when dealing with multiple input labels)
    --output_dir                                Specify a new output directory to avoid overwriting results (when dealing with multiple input labels) ($output_dir)

OPTIONAL ARGUMENTS (current value)
    --run_commit                                Run COMMIT on the tractogram ($run_commit)
    --b_thr                                     Tolerance value to match b-value is on the same shell ($b_thr)
    --nbr_dir                                   Number of directions, (half sphere), representing the possible orientations of the response functions ($nbr_dir)
    --ball_stick                                Use the ball&Stick model. Disable the zeppelin compartment for single-shell data ($ball_stick)
    --para_diff                                 Parallel diffusivity in mm^2/s ($para_diff)
    --perp_diff                                 Perpendicular diffusivity in mm^2/s ($perp_diff)
    --iso_diff                                  Istropic diffusivity in mm^2/s ($iso_diff)

    --no_pruning                                If set, will NOT prune on length ($no_pruning)
    --no_remove_loops                           If set, will NOT remove streamlines making loops ($no_remove_loops)
    --no_remove_outliers                        If set, will NOT remove outliers using QB ($no_remove_outliers)
    --min_length                                Pruning minimal segment length ($min_length)
    --max_length                                Pruning maximal segment length ($max_length)
    --loop_max_angle                            Maximal winding angle over which a streamline is considered as looping ($loop_max_angle)
    --outlier_threshold                         Outlier removal threshold when using hierarchical QB ($outlier_threshold)

    --run_afd_rd                                Run the computation of AFD/RD on all pairs of connections ($run_afd_rd)
    --length_weighting                          If set, will weigh the AFD values according to segment lengths for afd/rd ($length_weighting)
    --sh_basis                                  Spherical harmonics basis used for the SH coefficients  ($sh_basis)

    --use_similarity_metric                     Compute the average shape distance for each connection ($use_similarity_metric)
    --nbr_of_samples                             The average shape is computed from a random subset of subjects ($nbr_of_samples)

    --processes_register                        Number of processes for registration task ($processes_register)
    --processes_commit                          Number of processes for COMMIT task ($processes_commit)
    --processes_afd_rd                          Number of processes for AFD/RD task ($processes_afd_rd)
    --processes_avg_similarity                  Number of processes for average similarity task ($processes_avg_similarity)
    --processes_connectivity                    Number of processes for compute connectivity task ($processes_connectivity) 

NOTES

To set the number of parallel processes to launch, please use:
'nextflow run -qs {nb_processes}'.

The intermediate working directory is, by default, set to './work'.
To change it, use the '-w WORK_DIR' argument.

The default config file is freesurfer_pipeline/nextflow.config.
Use '-C config_file.config' to specify a non-default configuration file.
The '-C config_file.config' must be inserted after the nextflow call
like 'nextflow -C config_file.config run ...'.
